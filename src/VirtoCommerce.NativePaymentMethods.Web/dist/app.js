(()=>{var e;e="NativePaymentMethods",void 0!==AppDependencies&&AppDependencies.push(e),angular.module(e,[]).config(["$stateProvider","$urlRouterProvider",(e,t)=>{e.state("workspace.NativePaymentMethodsState",{url:"/NativePaymentMethods",templateUrl:"$(Platform)/Scripts/common/templates/home.tpl.html",controller:["$scope","platformWebApp.bladeNavigationService",(e,t)=>{t.showBlade({id:"payment-methods-list",controller:"NativePaymentMethods.methodsListController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/methods-list.tpl.html",isClosingDisabled:!0})}]})}]).run(["platformWebApp.mainMenuService","platformWebApp.widgetService","$state",(e,t,a)=>{var o={path:"browse/NativePaymentMethods",icon:"fa fa-money",title:"NativePaymentMethods.menu-item-name",priority:100,action:()=>{a.go("workspace.NativePaymentMethodsState")},permission:"NativePaymentMethods:access"};e.addMenuItem(o),t.registerWidget({controller:"NativePaymentMethods.paymentLogoWidgetController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/widgets/payment-logo-widget.html"},"nativePaymentDetails")}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.methodDetailsController",["$scope","NativePaymentMethods.webApi","platformWebApp.objCompareService","platformWebApp.dialogService","platformWebApp.bladeNavigationService",(e,t,a,o,n)=>{var r=e.blade;function i(){return r.originalEntity&&!a.equal(r.originalEntity,r.currentEntity)&&!r.isNew&&r.hasUpdatePermission()}r.headIcon="fa fa-money",r.refresh=()=>{r.currentEntityId?t.getById({id:r.currentEntityId},(e=>{r.currentEntity=e,r.originalEntity=angular.copy(r.currentEntity),r.title=e.name})):(r.currentEntity={isEnabled:!0},r.originalEntity=angular.copy(r.currentEntity),r.title="NativePaymentMethods.blades.method-details.labels.new-method"),r.isLoading=!1},e.setForm=e=>{r.formScope=e},r.metaFields=[{name:"code",isRequired:!0,isReadOnly:r.currentEntityId,title:"NativePaymentMethods.blades.method-details.labels.code",valueType:"ShortText"},{name:"name",isRequired:!0,isReadOnly:!1,title:"NativePaymentMethods.blades.method-details.labels.name",valueType:"ShortText"},{name:"isEnabled",title:"NativePaymentMethods.blades.method-details.labels.isEnabled",valueType:"Boolean"},{name:"description",title:"NativePaymentMethods.blades.method-details.labels.description",valueType:"LongText"}],r.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",executeMethod:()=>{r.refresh()},canExecuteMethod:()=>!0},{name:"platform.commands.save",icon:"fa fa-save",executeMethod:()=>{t.save(r.currentEntity,(t=>{var a=e.$parent.$parent.blades.find((e=>"payment-methods-list"===e.id));n.closeBlade(r),a.refresh()}),(function(e){n.setError(`${e.status}: ${e.statusText}`,r);var t={id:"errorDetails",title:"platform.dialogs.error-details.title",message:e.data.message};o.showErrorDialog(t)}))},canExecuteMethod:function(){return i()&&(!r.formScope||r.formScope.$valid)}},{name:"platform.commands.reset",icon:"fa fa-undo",executeMethod:()=>{angular.copy(r.originalEntity,r.currentEntity)},canExecuteMethod:i,permission:r.updatePermission}],r.refresh()}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.paymentDetailsLogoController",["$scope","FileUploader","platformWebApp.bladeNavigationService","platformWebApp.dialogService",(e,t,a,o)=>{var n=e.blade;if(n.title="NativePaymentMethods.blades.payment-logo.title",!e.logoUploader){const r=e.logoUploader=new t({scope:e,headers:{Accept:"application/json"},autoUpload:!0,removeAfterUpload:!0,filters:[{name:"imageFilter",fn:e=>{const t=/^.*\.(png|jpg|svg)$/.test(e.name.toLowerCase());if(!t){const e={title:"Filetype error",message:"Only PNG, JPG or SVG files are allowed."};o.showErrorDialog(e)}return t}}]});r.url="api/assets?folderUrl=nativepaymentlogos",r.onSuccessItem=(e,t)=>{n.currentEntity.logoUrl=t[0].url},r.onErrorItem=(e,t,o,r)=>{a.setError(e._file.name+" failed: "+(t.message?t.message:o),n)}}let r;function i(){return!angular.equals(n.currentEntity,n.originalEntity)}function l(){return i()&&r&&r.$valid}n.refresh=()=>{n.originalEntity=n.currentEntity,n.currentEntity=angular.copy(n.currentEntity),n.isLoading=!1},e.setForm=e=>{r=e},e.browseFiles=e=>{window.document.querySelector(`#${e}`).click()},n.saveChanges=()=>{angular.copy(n.currentEntity,n.originalEntity),e.bladeClose()},n.toolbarCommands=[{name:"platform.commands.save",icon:"fas fa-save",executeMethod:n.saveChanges,canExecuteMethod:l},{name:"platform.commands.set-to-default",icon:"fa fa-undo",executeMethod:()=>{n.currentEntity.logoUrl=null},canExecuteMethod:()=>!0}],n.onClose=e=>{a.showConfirmationIfNeeded(i(),l(),n,n.saveChanges,e,"NativePaymentMethods.dialogs.payment-details-save.title","NativePaymentMethods.dialogs.payment-details-save.message")},n.refresh()}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.methodsListController",["$scope","NativePaymentMethods.webApi","platformWebApp.bladeNavigationService",(e,t,a)=>{var o=[],n=e.blade;function r(e){var t={id:"payment-method-details",controller:"NativePaymentMethods.methodDetailsController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/method-details.tpl.html",currentEntityId:e};a.showBlade(t)}n.title="NativePaymentMethods.blades.methods-list.title",n.headIcon="fa fa-money",n.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",executeMethod:()=>{n.refresh()},canExecuteMethod:()=>!0},{name:"platform.commands.add",icon:"fa fa-plus",executeMethod:()=>{r(null)},canExecuteMethod:()=>!0},{name:"platform.commands.delete",icon:"fa fa-trash",executeMethod:()=>{var e=o.map((e=>e.id));t.delete({ids:e},(e=>{n.refresh()}))},canExecuteMethod:()=>o.length>0}],n.refresh=()=>{n.isLoading=!0,t.get((e=>{n.data=e.results,n.selectedAll=!1,n.isLoading=!1}))},e.updateSelectionList=()=>{o=n.data.filter((e=>e.selected))},e.selectAll=t=>{angular.forEach(n.data,(e=>{e.selected=t})),e.updateSelectionList()},e.selectNode=t=>{e.selectedNodeId=t.id,r(t.id)},n.refresh()}]),angular.module("NativePaymentMethods").factory("NativePaymentMethods.webApi",["$resource",e=>e("api/native-payment-methods",{},{delete:{method:"DELETE",url:"api/native-payment-methods"},getById:{method:"GET",url:"api/native-payment-methods/:id"},save:{method:"POST",url:"api/native-payment-methods"}})]),angular.module("platformWebApp").controller("NativePaymentMethods.paymentLogoWidgetController",["$scope","platformWebApp.bladeNavigationService",function(e,t){var a=e.blade;e.openBlade=function(){var e={id:"paymentDetailsLogo",currentEntity:a.currentEntity,controller:"NativePaymentMethods.paymentDetailsLogoController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/method-logo.html"};t.showBlade(e,a)}}])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSyxrQ0NMekNOLFFBQVFDLE9BQU8sa0JBQ1ZPLFdBQVcsbURBQW9ELENBQUMsU0FBVSx3Q0FBeUMsU0FBVUMsRUFBUUMsR0FDbEksSUFBSXNCLEVBQVF2QixFQUFPdUIsTUFFbkJ2QixFQUFPMEgsVUFBWSxXQUNmLElBQUlDLEVBQVcsQ0FDWHhILEdBQUkscUJBQ0p3QixjQUFlSixFQUFNSSxjQUNyQjVCLFdBQVksb0RBQ1pLLFNBQVUsaUZBR2RILEVBQXVCQyxVQUFVeUgsRUFBVXBHLFEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzLy4vU2NyaXB0cy9tb2R1bGUuanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcy8uL1NjcmlwdHMvYmxhZGVzL21ldGhvZC1kZXRhaWxzLmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuTmF0aXZlUGF5bWVudE1ldGhvZHMvLi9TY3JpcHRzL2JsYWRlcy9tZXRob2QtbG9nby5qcyIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzLy4vU2NyaXB0cy9ibGFkZXMvbWV0aG9kcy1saXN0LmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuTmF0aXZlUGF5bWVudE1ldGhvZHMvLi9TY3JpcHRzL3Jlc291cmNlcy9uYXRpdmUtcGF5bWVudC1tZXRob2RzLWFwaS5qcyIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzLy4vU2NyaXB0cy93aWRnZXRzL3BheW1lbnQtbG9nby13aWRnZXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ2FsbCB0aGlzIHRvIHJlZ2lzdGVyIHlvdXIgbW9kdWxlIHRvIG1haW4gYXBwbGljYXRpb25cbnZhciBtb2R1bGVOYW1lID0gJ05hdGl2ZVBheW1lbnRNZXRob2RzJztcblxuaWYgKEFwcERlcGVuZGVuY2llcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgQXBwRGVwZW5kZW5jaWVzLnB1c2gobW9kdWxlTmFtZSk7XG59XG5cbmFuZ3VsYXIubW9kdWxlKG1vZHVsZU5hbWUsIFtdKVxuICAgIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLFxuICAgICAgICAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikgPT4ge1xuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3dvcmtzcGFjZS5OYXRpdmVQYXltZW50TWV0aG9kc1N0YXRlJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvTmF0aXZlUGF5bWVudE1ldGhvZHMnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJyQoUGxhdGZvcm0pL1NjcmlwdHMvY29tbW9uL3RlbXBsYXRlcy9ob21lLnRwbC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgJyRzY29wZScsICdwbGF0Zm9ybVdlYkFwcC5ibGFkZU5hdmlnYXRpb25TZXJ2aWNlJywgKCRzY29wZSwgYmxhZGVOYXZpZ2F0aW9uU2VydmljZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdCbGFkZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdwYXltZW50LW1ldGhvZHMtbGlzdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOYXRpdmVQYXltZW50TWV0aG9kcy5tZXRob2RzTGlzdENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ01vZHVsZXMvJChWaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzKS9TY3JpcHRzL2JsYWRlcy9tZXRob2RzLWxpc3QudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0Nsb3NpbmdEaXNhYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICBdKVxuICAgIC5ydW4oWydwbGF0Zm9ybVdlYkFwcC5tYWluTWVudVNlcnZpY2UnLCAncGxhdGZvcm1XZWJBcHAud2lkZ2V0U2VydmljZScsICckc3RhdGUnLFxuICAgICAgICAobWFpbk1lbnVTZXJ2aWNlLCB3aWRnZXRTZXJ2aWNlLCAkc3RhdGUpID0+IHtcbiAgICAgICAgICAgIC8vUmVnaXN0ZXIgbW9kdWxlIGluIG1haW4gbWVudVxuICAgICAgICAgICAgdmFyIG1lbnVJdGVtID0ge1xuICAgICAgICAgICAgICAgIHBhdGg6ICdicm93c2UvTmF0aXZlUGF5bWVudE1ldGhvZHMnLFxuICAgICAgICAgICAgICAgIGljb246ICdmYSBmYS1tb25leScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdOYXRpdmVQYXltZW50TWV0aG9kcy5tZW51LWl0ZW0tbmFtZScsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEwMCxcbiAgICAgICAgICAgICAgICBhY3Rpb246ICgpID0+IHsgJHN0YXRlLmdvKCd3b3Jrc3BhY2UuTmF0aXZlUGF5bWVudE1ldGhvZHNTdGF0ZScpOyB9LFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb246ICdOYXRpdmVQYXltZW50TWV0aG9kczphY2Nlc3MnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbWFpbk1lbnVTZXJ2aWNlLmFkZE1lbnVJdGVtKG1lbnVJdGVtKTtcblxuICAgICAgICAgICAgLy9SZWdpc3RlciB3aWRnZXRzXG4gICAgICAgICAgICB3aWRnZXRTZXJ2aWNlLnJlZ2lzdGVyV2lkZ2V0KHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTmF0aXZlUGF5bWVudE1ldGhvZHMucGF5bWVudExvZ29XaWRnZXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ01vZHVsZXMvJChWaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzKS9TY3JpcHRzL3dpZGdldHMvcGF5bWVudC1sb2dvLXdpZGdldC5odG1sJ1xuICAgICAgICAgICAgfSwgJ25hdGl2ZVBheW1lbnREZXRhaWxzJyk7XG4gICAgICAgIH1cbiAgICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLm1ldGhvZERldGFpbHNDb250cm9sbGVyJywgWyckc2NvcGUnLCAnTmF0aXZlUGF5bWVudE1ldGhvZHMud2ViQXBpJywgJ3BsYXRmb3JtV2ViQXBwLm9iakNvbXBhcmVTZXJ2aWNlJywgJ3BsYXRmb3JtV2ViQXBwLmRpYWxvZ1NlcnZpY2UnLCAncGxhdGZvcm1XZWJBcHAuYmxhZGVOYXZpZ2F0aW9uU2VydmljZScsXG4gICAgICAgICgkc2NvcGUsIGFwaSwgb2JqQ29tcGFyZVNlcnZpY2UsIGRpYWxvZ1NlcnZpY2UsIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UpID0+IHtcbiAgICAgICAgICAgIHZhciBibGFkZSA9ICRzY29wZS5ibGFkZTtcblxuICAgICAgICAgICAgYmxhZGUuaGVhZEljb24gPSAnZmEgZmEtbW9uZXknO1xuXG4gICAgICAgICAgICBibGFkZS5yZWZyZXNoID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChibGFkZS5jdXJyZW50RW50aXR5SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBpLmdldEJ5SWQoeyBpZDogYmxhZGUuY3VycmVudEVudGl0eUlkIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUuY3VycmVudEVudGl0eSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibGFkZS5vcmlnaW5hbEVudGl0eSA9IGFuZ3VsYXIuY29weShibGFkZS5jdXJyZW50RW50aXR5KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLnRpdGxlID0gcmVzdWx0Lm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBibGFkZS5jdXJyZW50RW50aXR5ID0geyBpc0VuYWJsZWQ6IHRydWUgfVxuICAgICAgICAgICAgICAgICAgICBibGFkZS5vcmlnaW5hbEVudGl0eSA9IGFuZ3VsYXIuY29weShibGFkZS5jdXJyZW50RW50aXR5KTtcblxuICAgICAgICAgICAgICAgICAgICBibGFkZS50aXRsZSA9IFwiTmF0aXZlUGF5bWVudE1ldGhvZHMuYmxhZGVzLm1ldGhvZC1kZXRhaWxzLmxhYmVscy5uZXctbWV0aG9kXCI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuc2V0Rm9ybSA9IChmb3JtKSA9PiB7XG4gICAgICAgICAgICAgICAgYmxhZGUuZm9ybVNjb3BlID0gZm9ybTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNhblNhdmUoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRGlydHkoKSAmJiAoIWJsYWRlLmZvcm1TY29wZSB8fCBibGFkZS5mb3JtU2NvcGUuJHZhbGlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaXNEaXJ0eSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmxhZGUub3JpZ2luYWxFbnRpdHkgJiYgIW9iakNvbXBhcmVTZXJ2aWNlLmVxdWFsKGJsYWRlLm9yaWdpbmFsRW50aXR5LCBibGFkZS5jdXJyZW50RW50aXR5KSAmJiAhYmxhZGUuaXNOZXcgJiYgYmxhZGUuaGFzVXBkYXRlUGVybWlzc2lvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBibGFkZS5tZXRhRmllbGRzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2NvZGUnLFxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBpc1JlYWRPbmx5OiBibGFkZS5jdXJyZW50RW50aXR5SWQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIk5hdGl2ZVBheW1lbnRNZXRob2RzLmJsYWRlcy5tZXRob2QtZGV0YWlscy5sYWJlbHMuY29kZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlVHlwZTogXCJTaG9ydFRleHRcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbmFtZScsXG4gICAgICAgICAgICAgICAgICAgIGlzUmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGlzUmVhZE9ubHk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMubWV0aG9kLWRldGFpbHMubGFiZWxzLm5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVUeXBlOiBcIlNob3J0VGV4dFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdpc0VuYWJsZWQnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMubWV0aG9kLWRldGFpbHMubGFiZWxzLmlzRW5hYmxlZFwiLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVR5cGU6IFwiQm9vbGVhblwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdkZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIk5hdGl2ZVBheW1lbnRNZXRob2RzLmJsYWRlcy5tZXRob2QtZGV0YWlscy5sYWJlbHMuZGVzY3JpcHRpb25cIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVUeXBlOiBcIkxvbmdUZXh0XCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBibGFkZS50b29sYmFyQ29tbWFuZHMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInBsYXRmb3JtLmNvbW1hbmRzLnJlZnJlc2hcIiwgaWNvbjogJ2ZhIGZhLXJlZnJlc2gnLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7IGJsYWRlLnJlZnJlc2goKSB9LFxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiAoKSA9PiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwicGxhdGZvcm0uY29tbWFuZHMuc2F2ZVwiLCBpY29uOiAnZmEgZmEtc2F2ZScsXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zYXZlKGJsYWRlLmN1cnJlbnRFbnRpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdEJsYWRlID0gJHNjb3BlLiRwYXJlbnQuJHBhcmVudC5ibGFkZXMuZmluZCh4ID0+IHguaWQgPT09IFwicGF5bWVudC1tZXRob2RzLWxpc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UuY2xvc2VCbGFkZShibGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RCbGFkZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2Uuc2V0RXJyb3IoYCR7ZXJyb3Iuc3RhdHVzfTogJHtlcnJvci5zdGF0dXNUZXh0fWAsIGJsYWRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yRGlhbG9nID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogXCJlcnJvckRldGFpbHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdwbGF0Zm9ybS5kaWFsb2dzLmVycm9yLWRldGFpbHMudGl0bGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5kYXRhLm1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nU2VydmljZS5zaG93RXJyb3JEaWFsb2coZXJyb3JEaWFsb2cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGNhblNhdmVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5yZXNldFwiLCBpY29uOiAnZmEgZmEtdW5kbycsXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuY29weShibGFkZS5vcmlnaW5hbEVudGl0eSwgYmxhZGUuY3VycmVudEVudGl0eSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGlzRGlydHksXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246IGJsYWRlLnVwZGF0ZVBlcm1pc3Npb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBibGFkZS5yZWZyZXNoKCk7XG4gICAgICAgIH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLnBheW1lbnREZXRhaWxzTG9nb0NvbnRyb2xsZXInLCBbJyRzY29wZScsICdGaWxlVXBsb2FkZXInLCAncGxhdGZvcm1XZWJBcHAuYmxhZGVOYXZpZ2F0aW9uU2VydmljZScsICdwbGF0Zm9ybVdlYkFwcC5kaWFsb2dTZXJ2aWNlJyxcbiAgICAgICAgKCRzY29wZSwgRmlsZVVwbG9hZGVyLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlLCBkaWFsb2dTZXJ2aWNlKSA9PiB7XG4gICAgICAgICAgICB2YXIgYmxhZGUgPSAkc2NvcGUuYmxhZGU7XG4gICAgICAgICAgICBibGFkZS50aXRsZSA9ICdOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMucGF5bWVudC1sb2dvLnRpdGxlJztcblxuICAgICAgICAgICAgaWYgKCEkc2NvcGUubG9nb1VwbG9hZGVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbG9nb1VwbG9hZGVyID0gJHNjb3BlLmxvZ29VcGxvYWRlciA9IG5ldyBGaWxlVXBsb2FkZXIoe1xuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgICAgICAgICAgICAgIGF1dG9VcGxvYWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUFmdGVyVXBsb2FkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2ltYWdlRmlsdGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcHJvdmFsID0gL14uKlxcLihwbmd8anBnfHN2ZykkLy50ZXN0KGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFwcHJvdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpYWxvZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkZpbGV0eXBlIGVycm9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIk9ubHkgUE5HLCBKUEcgb3IgU1ZHIGZpbGVzIGFyZSBhbGxvd2VkLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ1NlcnZpY2Uuc2hvd0Vycm9yRGlhbG9nKGRpYWxvZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHByb3ZhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGxvZ29VcGxvYWRlci51cmwgPSAnYXBpL2Fzc2V0cz9mb2xkZXJVcmw9bmF0aXZlcGF5bWVudGxvZ29zJztcblxuICAgICAgICAgICAgICAgIGxvZ29VcGxvYWRlci5vblN1Y2Nlc3NJdGVtID0gKF8sIHVwbG9hZGVkSW1hZ2VzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLmN1cnJlbnRFbnRpdHkubG9nb1VybCA9IHVwbG9hZGVkSW1hZ2VzWzBdLnVybDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgbG9nb1VwbG9hZGVyLm9uRXJyb3JJdGVtID0gKGVsZW1lbnQsIHJlc3BvbnNlLCBzdGF0dXMsIF8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zZXRFcnJvcihlbGVtZW50Ll9maWxlLm5hbWUgKyAnIGZhaWxlZDogJyArIChyZXNwb25zZS5tZXNzYWdlID8gcmVzcG9uc2UubWVzc2FnZSA6IHN0YXR1cyksIGJsYWRlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBibGFkZS5yZWZyZXNoID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGJsYWRlLm9yaWdpbmFsRW50aXR5ID0gYmxhZGUuY3VycmVudEVudGl0eTtcbiAgICAgICAgICAgICAgICBibGFkZS5jdXJyZW50RW50aXR5ID0gYW5ndWxhci5jb3B5KGJsYWRlLmN1cnJlbnRFbnRpdHkpO1xuXG4gICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgZm9ybVNjb3BlO1xuICAgICAgICAgICAgJHNjb3BlLnNldEZvcm0gPSAoZm9ybSkgPT4geyBmb3JtU2NvcGUgPSBmb3JtOyB9XG5cbiAgICAgICAgICAgICRzY29wZS5icm93c2VGaWxlcyA9IChpZCkgPT4ge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKS5jbGljaygpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGlydHkoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFhbmd1bGFyLmVxdWFscyhibGFkZS5jdXJyZW50RW50aXR5LCBibGFkZS5vcmlnaW5hbEVudGl0eSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNhblNhdmUoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRGlydHkoKSAmJiBmb3JtU2NvcGUgJiYgZm9ybVNjb3BlLiR2YWxpZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYmxhZGUuc2F2ZUNoYW5nZXMgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5jb3B5KGJsYWRlLmN1cnJlbnRFbnRpdHksIGJsYWRlLm9yaWdpbmFsRW50aXR5KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmxhZGVDbG9zZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYmxhZGUudG9vbGJhckNvbW1hbmRzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5zYXZlXCIsIGljb246ICdmYXMgZmEtc2F2ZScsXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6IGJsYWRlLnNhdmVDaGFuZ2VzLFxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBjYW5TYXZlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwicGxhdGZvcm0uY29tbWFuZHMuc2V0LXRvLWRlZmF1bHRcIiwgaWNvbjogJ2ZhIGZhLXVuZG8nLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBibGFkZS5jdXJyZW50RW50aXR5LmxvZ29VcmwgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiAoKSA9PiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgYmxhZGUub25DbG9zZSA9IChjbG9zZUNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93Q29uZmlybWF0aW9uSWZOZWVkZWQoaXNEaXJ0eSgpLCBjYW5TYXZlKCksIGJsYWRlLCBibGFkZS5zYXZlQ2hhbmdlcywgY2xvc2VDYWxsYmFjayxcbiAgICAgICAgICAgICAgICAgICAgXCJOYXRpdmVQYXltZW50TWV0aG9kcy5kaWFsb2dzLnBheW1lbnQtZGV0YWlscy1zYXZlLnRpdGxlXCIsIFwiTmF0aXZlUGF5bWVudE1ldGhvZHMuZGlhbG9ncy5wYXltZW50LWRldGFpbHMtc2F2ZS5tZXNzYWdlXCIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCgpO1xuICAgIH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLm1ldGhvZHNMaXN0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ05hdGl2ZVBheW1lbnRNZXRob2RzLndlYkFwaScsICdwbGF0Zm9ybVdlYkFwcC5ibGFkZU5hdmlnYXRpb25TZXJ2aWNlJyxcbiAgICAgICAgKCRzY29wZSwgYXBpLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlKSA9PiB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtcyA9IFtdO1xuXG4gICAgICAgICAgICB2YXIgYmxhZGUgPSAkc2NvcGUuYmxhZGU7XG4gICAgICAgICAgICBibGFkZS50aXRsZSA9ICdOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMubWV0aG9kcy1saXN0LnRpdGxlJztcbiAgICAgICAgICAgIGJsYWRlLmhlYWRJY29uID0gJ2ZhIGZhLW1vbmV5JztcbiAgICAgICAgICAgIGJsYWRlLnRvb2xiYXJDb21tYW5kcyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwicGxhdGZvcm0uY29tbWFuZHMucmVmcmVzaFwiLCBpY29uOiAnZmEgZmEtcmVmcmVzaCcsXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6ICgpID0+IHsgYmxhZGUucmVmcmVzaCgpIH0sXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6ICgpID0+IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5hZGRcIiwgaWNvbjogJ2ZhIGZhLXBsdXMnLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7IHNob3dEZXRhaWxzQmxhZGUobnVsbCkgfSxcbiAgICAgICAgICAgICAgICAgICAgY2FuRXhlY3V0ZU1ldGhvZDogKCkgPT4gdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInBsYXRmb3JtLmNvbW1hbmRzLmRlbGV0ZVwiLCBpY29uOiAnZmEgZmEtdHJhc2gnLFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRzID0gc2VsZWN0ZWRJdGVtcy5tYXAoeCA9PiB4LmlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmRlbGV0ZSh7IGlkczogaWRzIH0sIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibGFkZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2FuRXhlY3V0ZU1ldGhvZDogKCkgPT4gc2VsZWN0ZWRJdGVtcy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBibGFkZS5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGFwaS5nZXQoKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuZGF0YSA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuc2VsZWN0ZWRBbGwgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBibGFkZS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS51cGRhdGVTZWxlY3Rpb25MaXN0ID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMgPSBibGFkZS5kYXRhLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5zZWxlY3RlZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RBbGwgPSAoc2VsZWN0ZWQpID0+IHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goYmxhZGUuZGF0YSwgKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVTZWxlY3Rpb25MaXN0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS5zZWxlY3ROb2RlID0gKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWROb2RlSWQgPSBub2RlLmlkO1xuXG4gICAgICAgICAgICAgICAgc2hvd0RldGFpbHNCbGFkZShub2RlLmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2hvd0RldGFpbHNCbGFkZSAoaXRlbUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRldGFpbHNCbGFkZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdwYXltZW50LW1ldGhvZC1kZXRhaWxzJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ05hdGl2ZVBheW1lbnRNZXRob2RzLm1ldGhvZERldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdNb2R1bGVzLyQoVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcykvU2NyaXB0cy9ibGFkZXMvbWV0aG9kLWRldGFpbHMudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5SWQ6IGl0ZW1JZFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBibGFkZU5hdmlnYXRpb25TZXJ2aWNlLnNob3dCbGFkZShkZXRhaWxzQmxhZGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBibGFkZS5yZWZyZXNoKCk7XG4gICAgICAgIH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXG4gICAgLmZhY3RvcnkoJ05hdGl2ZVBheW1lbnRNZXRob2RzLndlYkFwaScsIFsnJHJlc291cmNlJywgKCRyZXNvdXJjZSkgPT4ge1xuICAgICAgICByZXR1cm4gJHJlc291cmNlKCdhcGkvbmF0aXZlLXBheW1lbnQtbWV0aG9kcycsIHt9LCB7XG4gICAgICAgICAgICBkZWxldGU6IHsgbWV0aG9kOiAnREVMRVRFJywgdXJsOiAnYXBpL25hdGl2ZS1wYXltZW50LW1ldGhvZHMnIH0sXG4gICAgICAgICAgICBnZXRCeUlkOiB7IG1ldGhvZDogJ0dFVCcsIHVybDogJ2FwaS9uYXRpdmUtcGF5bWVudC1tZXRob2RzLzppZCcgfSxcbiAgICAgICAgICAgIHNhdmU6IHsgbWV0aG9kOiAnUE9TVCcsIHVybDogJ2FwaS9uYXRpdmUtcGF5bWVudC1tZXRob2RzJyB9XG4gICAgICAgIH0pO1xuICAgIH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwbGF0Zm9ybVdlYkFwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLnBheW1lbnRMb2dvV2lkZ2V0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIHZhciBibGFkZSA9ICRzY29wZS5ibGFkZTtcblxuICAgICAgICAkc2NvcGUub3BlbkJsYWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG5ld0JsYWRlID0ge1xuICAgICAgICAgICAgICAgIGlkOiAncGF5bWVudERldGFpbHNMb2dvJyxcbiAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5OiBibGFkZS5jdXJyZW50RW50aXR5LFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOYXRpdmVQYXltZW50TWV0aG9kcy5wYXltZW50RGV0YWlsc0xvZ29Db250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ01vZHVsZXMvJChWaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzKS9TY3JpcHRzL2JsYWRlcy9tZXRob2QtbG9nby5odG1sJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUsIGJsYWRlKTtcbiAgICAgICAgfTtcbn1dKTtcbiJdLCJuYW1lcyI6WyJtb2R1bGVOYW1lIiwidW5kZWZpbmVkIiwiQXBwRGVwZW5kZW5jaWVzIiwicHVzaCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiYmxhZGVOYXZpZ2F0aW9uU2VydmljZSIsInNob3dCbGFkZSIsImlkIiwidGVtcGxhdGUiLCJpc0Nsb3NpbmdEaXNhYmxlZCIsInJ1biIsIm1haW5NZW51U2VydmljZSIsIndpZGdldFNlcnZpY2UiLCIkc3RhdGUiLCJtZW51SXRlbSIsInBhdGgiLCJpY29uIiwidGl0bGUiLCJwcmlvcml0eSIsImFjdGlvbiIsImdvIiwicGVybWlzc2lvbiIsImFkZE1lbnVJdGVtIiwicmVnaXN0ZXJXaWRnZXQiLCJhcGkiLCJvYmpDb21wYXJlU2VydmljZSIsImRpYWxvZ1NlcnZpY2UiLCJibGFkZSIsImlzRGlydHkiLCJvcmlnaW5hbEVudGl0eSIsImVxdWFsIiwiY3VycmVudEVudGl0eSIsImlzTmV3IiwiaGFzVXBkYXRlUGVybWlzc2lvbiIsImhlYWRJY29uIiwicmVmcmVzaCIsImN1cnJlbnRFbnRpdHlJZCIsImdldEJ5SWQiLCJyZXN1bHQiLCJjb3B5IiwibmFtZSIsImlzRW5hYmxlZCIsImlzTG9hZGluZyIsInNldEZvcm0iLCJmb3JtIiwiZm9ybVNjb3BlIiwibWV0YUZpZWxkcyIsImlzUmVxdWlyZWQiLCJpc1JlYWRPbmx5IiwidmFsdWVUeXBlIiwidG9vbGJhckNvbW1hbmRzIiwiZXhlY3V0ZU1ldGhvZCIsImNhbkV4ZWN1dGVNZXRob2QiLCJzYXZlIiwibGlzdEJsYWRlIiwiJHBhcmVudCIsImJsYWRlcyIsImZpbmQiLCJ4IiwiY2xvc2VCbGFkZSIsImVycm9yIiwic2V0RXJyb3IiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiZXJyb3JEaWFsb2ciLCJtZXNzYWdlIiwiZGF0YSIsInNob3dFcnJvckRpYWxvZyIsIiR2YWxpZCIsInVwZGF0ZVBlcm1pc3Npb24iLCJGaWxlVXBsb2FkZXIiLCJsb2dvVXBsb2FkZXIiLCJzY29wZSIsImhlYWRlcnMiLCJBY2NlcHQiLCJhdXRvVXBsb2FkIiwicmVtb3ZlQWZ0ZXJVcGxvYWQiLCJmaWx0ZXJzIiwiZm4iLCJpdGVtIiwiYXBwcm92YWwiLCJ0ZXN0IiwidG9Mb3dlckNhc2UiLCJkaWFsb2ciLCJvblN1Y2Nlc3NJdGVtIiwiXyIsInVwbG9hZGVkSW1hZ2VzIiwibG9nb1VybCIsIm9uRXJyb3JJdGVtIiwiZWxlbWVudCIsInJlc3BvbnNlIiwiX2ZpbGUiLCJlcXVhbHMiLCJjYW5TYXZlIiwiYnJvd3NlRmlsZXMiLCJ3aW5kb3ciLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGljayIsInNhdmVDaGFuZ2VzIiwiYmxhZGVDbG9zZSIsIm9uQ2xvc2UiLCJjbG9zZUNhbGxiYWNrIiwic2hvd0NvbmZpcm1hdGlvbklmTmVlZGVkIiwic2VsZWN0ZWRJdGVtcyIsInNob3dEZXRhaWxzQmxhZGUiLCJpdGVtSWQiLCJkZXRhaWxzQmxhZGUiLCJpZHMiLCJtYXAiLCJkZWxldGUiLCJsZW5ndGgiLCJnZXQiLCJyZXN1bHRzIiwic2VsZWN0ZWRBbGwiLCJ1cGRhdGVTZWxlY3Rpb25MaXN0IiwiZmlsdGVyIiwic2VsZWN0ZWQiLCJzZWxlY3RBbGwiLCJmb3JFYWNoIiwic2VsZWN0Tm9kZSIsIm5vZGUiLCJzZWxlY3RlZE5vZGVJZCIsImZhY3RvcnkiLCIkcmVzb3VyY2UiLCJtZXRob2QiLCJvcGVuQmxhZGUiLCJuZXdCbGFkZSJdLCJzb3VyY2VSb290IjoiIn0=