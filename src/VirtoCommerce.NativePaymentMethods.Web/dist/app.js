(()=>{var e;e="NativePaymentMethods",void 0!==AppDependencies&&AppDependencies.push(e),angular.module(e,[]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("workspace.NativePaymentMethodsState",{url:"/NativePaymentMethods",templateUrl:"$(Platform)/Scripts/common/templates/home.tpl.html",controller:["$scope","platformWebApp.bladeNavigationService",function(e,t){t.showBlade({id:"payment-methods-list",controller:"NativePaymentMethods.methodsListController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/methods-list.tpl.html",isClosingDisabled:!0})}]})}]).run(["platformWebApp.mainMenuService","platformWebApp.widgetService","$state",function(e,t,a){var o={path:"browse/NativePaymentMethods",icon:"fa fa-money",title:"NativePaymentMethods.menu-item-name",priority:100,action:function(){a.go("workspace.NativePaymentMethodsState")},permission:"NativePaymentMethods:access"};e.addMenuItem(o),t.registerWidget({controller:"NativePaymentMethods.paymentLogoWidgetController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/widgets/payment-logo-widget.html"},"nativePaymentDetails")}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.methodDetailsController",["$scope","NativePaymentMethods.webApi","platformWebApp.objCompareService","platformWebApp.bladeNavigationService",(e,t,a,o)=>{var n=e.blade;function i(){return n.originalEntity&&!a.equal(n.originalEntity,n.currentEntity)&&!n.isNew&&n.hasUpdatePermission()}n.headIcon="fa fa-money",n.refresh=()=>{n.currentEntityId?t.getById({id:n.currentEntityId},(e=>{n.currentEntity=e,n.originalEntity=angular.copy(n.currentEntity),n.title=e.name})):(n.currentEntity={isEnabled:!0},n.originalEntity=angular.copy(n.currentEntity),n.title="NativePaymentMethods.blades.method-details.labels.new-method"),n.isLoading=!1},e.setForm=function(e){n.formScope=e},n.metaFields=[{name:"name",isRequired:!0,isReadOnly:!1,title:"NativePaymentMethods.blades.method-details.labels.name",valueType:"ShortText"},{name:"code",isRequired:!0,isReadOnly:!1,title:"NativePaymentMethods.blades.method-details.labels.code",valueType:"ShortText"},{name:"isEnabled",title:"NativePaymentMethods.blades.method-details.labels.isEnabled",valueType:"Boolean"},{name:"description",title:"NativePaymentMethods.blades.method-details.labels.description",valueType:"LongText"}],n.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",executeMethod:()=>{n.refresh()},canExecuteMethod:()=>!0},{name:"platform.commands.save",icon:"fa fa-save",executeMethod:()=>{t.save(n.currentEntity,(t=>{var a=e.$parent.$parent.blades.find((e=>"payment-methods-list"===e.id));o.closeBlade(n),a.refresh()}))},canExecuteMethod:function(){return i()&&(!n.formScope||n.formScope.$valid)}},{name:"platform.commands.reset",icon:"fa fa-undo",executeMethod:()=>{angular.copy(n.originalEntity,n.currentEntity)},canExecuteMethod:i,permission:n.updatePermission}],n.refresh()}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.paymentDetailsLogoController",["$scope","FileUploader","platformWebApp.bladeNavigationService","platformWebApp.dialogService",function(e,t,a,o){var n=e.blade;if(n.title="NativePaymentMethods.blades.payment-logo.title",!e.logoUploader){const i=e.logoUploader=new t({scope:e,headers:{Accept:"application/json"},autoUpload:!0,removeAfterUpload:!0,filters:[{name:"imageFilter",fn:function(e){const t=/^.*\.(png|gif|svg)$/.test(e.name);if(!t){const e={title:"Filetype error",message:"Only PNG, GIF or SVG files are allowed."};o.showErrorDialog(e)}return t}}]});i.url="api/assets?folderUrl=paymentLogos",i.onSuccessItem=function(e,t){n.currentEntity.logoUrl=t[0].url},i.onErrorItem=function(e,t,o,i){a.setError(e._file.name+" failed: "+(t.message?t.message:o),n)}}let i;function r(){return!angular.equals(n.currentEntity,n.originalEntity)}function l(){return r()&&i&&i.$valid}n.refresh=function(){n.originalEntity=n.currentEntity,n.currentEntity=angular.copy(n.currentEntity),n.isLoading=!1},e.setForm=function(e){i=e},e.browseFiles=function(e){window.document.querySelector(`#${e}`).click()},n.saveChanges=function(){angular.copy(n.currentEntity,n.originalEntity),e.bladeClose()},n.toolbarCommands=[{name:"platform.commands.save",icon:"fas fa-save",executeMethod:n.saveChanges,canExecuteMethod:l},{name:"platform.commands.set-to-default",icon:"fa fa-undo",executeMethod:function(){n.currentEntity.logoUrl=null},canExecuteMethod:function(){return!0}}],n.onClose=function(e){a.showConfirmationIfNeeded(r(),l(),n,n.saveChanges,e,"NativePaymentMethods.dialogs.payment-details-save.title","NativePaymentMethods.dialogs.payment-details-save.message")},n.refresh()}]),angular.module("NativePaymentMethods").controller("NativePaymentMethods.methodsListController",["$scope","NativePaymentMethods.webApi","platformWebApp.bladeNavigationService",(e,t,a)=>{var o=[],n=e.blade;function i(e){var t={id:"payment-method-details",controller:"NativePaymentMethods.methodDetailsController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/method-details.tpl.html",currentEntityId:e};a.showBlade(t)}n.title="NativePaymentMethods.blades.methods-list.title",n.headIcon="fa fa-money",n.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",executeMethod:()=>{n.refresh()},canExecuteMethod:()=>!0},{name:"platform.commands.add",icon:"fa fa-plus",executeMethod:()=>{i(null)},canExecuteMethod:()=>!0},{name:"platform.commands.delete",icon:"fa fa-trash",executeMethod:()=>{var e=o.map((e=>e.id));t.delete({ids:e},(e=>{n.refresh()}))},canExecuteMethod:()=>o.length>0}],n.refresh=()=>{n.isLoading=!0,t.get((e=>{n.data=e.results,n.selectedAll=!1,n.isLoading=!1}))},e.updateSelectionList=()=>{o=n.data.filter((e=>e.selected))},e.selectAll=t=>{angular.forEach(n.data,(e=>{e.selected=t})),e.updateSelectionList()},e.selectNode=t=>{e.selectedNodeId=t.id,i(t.id)},n.refresh()}]),angular.module("NativePaymentMethods").factory("NativePaymentMethods.webApi",["$resource",function(e){return e("api/native-payment-methods",{},{delete:{method:"DELETE",url:"api/native-payment-methods"},getById:{method:"GET",url:"api/native-payment-methods/:id"},save:{method:"POST",url:"api/native-payment-methods"}})}]),angular.module("platformWebApp").controller("NativePaymentMethods.paymentLogoWidgetController",["$scope","platformWebApp.bladeNavigationService",function(e,t){var a=e.blade;e.openBlade=function(){var e={id:"paymentDetailsLogo",currentEntity:a.currentEntity,controller:"NativePaymentMethods.paymentDetailsLogoController",template:"Modules/$(VirtoCommerce.NativePaymentMethods)/Scripts/blades/method-logo.html"};t.showBlade(e,a)}}])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNKdUIsY0FBZUosRUFBTUksY0FDckIzQixXQUFZLG9EQUNaSyxTQUFVLGlGQUdkSCxFQUF1QkMsVUFBVXFILEVBQVVqRyxRIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcy8uL1NjcmlwdHMvbW9kdWxlLmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuTmF0aXZlUGF5bWVudE1ldGhvZHMvLi9TY3JpcHRzL2JsYWRlcy9tZXRob2QtZGV0YWlscy5qcyIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzLy4vU2NyaXB0cy9ibGFkZXMvbWV0aG9kLWxvZ28uanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcy8uL1NjcmlwdHMvYmxhZGVzL21ldGhvZHMtbGlzdC5qcyIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzLy4vU2NyaXB0cy9yZXNvdXJjZXMvbmF0aXZlLXBheW1lbnQtbWV0aG9kcy1hcGkuanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcy8uL1NjcmlwdHMvd2lkZ2V0cy9wYXltZW50LWxvZ28td2lkZ2V0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENhbGwgdGhpcyB0byByZWdpc3RlciB5b3VyIG1vZHVsZSB0byBtYWluIGFwcGxpY2F0aW9uXHJcbnZhciBtb2R1bGVOYW1lID0gJ05hdGl2ZVBheW1lbnRNZXRob2RzJztcclxuXHJcbmlmIChBcHBEZXBlbmRlbmNpZXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgQXBwRGVwZW5kZW5jaWVzLnB1c2gobW9kdWxlTmFtZSk7XHJcbn1cclxuXHJcbmFuZ3VsYXIubW9kdWxlKG1vZHVsZU5hbWUsIFtdKVxyXG4gICAgLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlcicsXHJcbiAgICAgICAgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnd29ya3NwYWNlLk5hdGl2ZVBheW1lbnRNZXRob2RzU3RhdGUnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL05hdGl2ZVBheW1lbnRNZXRob2RzJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJyQoUGxhdGZvcm0pL1NjcmlwdHMvY29tbW9uL3RlbXBsYXRlcy9ob21lLnRwbC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICckc2NvcGUnLCAncGxhdGZvcm1XZWJBcHAuYmxhZGVOYXZpZ2F0aW9uU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdCbGFkZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3BheW1lbnQtbWV0aG9kcy1saXN0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTmF0aXZlUGF5bWVudE1ldGhvZHMubWV0aG9kc0xpc3RDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ01vZHVsZXMvJChWaXJ0b0NvbW1lcmNlLk5hdGl2ZVBheW1lbnRNZXRob2RzKS9TY3JpcHRzL2JsYWRlcy9tZXRob2RzLWxpc3QudHBsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvc2luZ0Rpc2FibGVkOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgXSlcclxuICAgIC5ydW4oWydwbGF0Zm9ybVdlYkFwcC5tYWluTWVudVNlcnZpY2UnLCAncGxhdGZvcm1XZWJBcHAud2lkZ2V0U2VydmljZScsICckc3RhdGUnLFxyXG4gICAgICAgIGZ1bmN0aW9uIChtYWluTWVudVNlcnZpY2UsIHdpZGdldFNlcnZpY2UsICRzdGF0ZSkge1xyXG4gICAgICAgICAgICAvL1JlZ2lzdGVyIG1vZHVsZSBpbiBtYWluIG1lbnVcclxuICAgICAgICAgICAgdmFyIG1lbnVJdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ2Jyb3dzZS9OYXRpdmVQYXltZW50TWV0aG9kcycsXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnZmEgZmEtbW9uZXknLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdOYXRpdmVQYXltZW50TWV0aG9kcy5tZW51LWl0ZW0tbmFtZScsXHJcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogMTAwLFxyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7ICRzdGF0ZS5nbygnd29ya3NwYWNlLk5hdGl2ZVBheW1lbnRNZXRob2RzU3RhdGUnKTsgfSxcclxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb246ICdOYXRpdmVQYXltZW50TWV0aG9kczphY2Nlc3MnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIG1haW5NZW51U2VydmljZS5hZGRNZW51SXRlbShtZW51SXRlbSk7XHJcblxyXG4gICAgICAgICAgICAvL1JlZ2lzdGVyIHdpZGdldHNcclxuICAgICAgICAgICAgd2lkZ2V0U2VydmljZS5yZWdpc3RlcldpZGdldCh7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTmF0aXZlUGF5bWVudE1ldGhvZHMucGF5bWVudExvZ29XaWRnZXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuTmF0aXZlUGF5bWVudE1ldGhvZHMpL1NjcmlwdHMvd2lkZ2V0cy9wYXltZW50LWxvZ28td2lkZ2V0Lmh0bWwnXHJcbiAgICAgICAgICAgIH0sICduYXRpdmVQYXltZW50RGV0YWlscycpO1xyXG4gICAgICAgIH1cclxuICAgIF0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgnTmF0aXZlUGF5bWVudE1ldGhvZHMnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLm1ldGhvZERldGFpbHNDb250cm9sbGVyJywgWyckc2NvcGUnLCAnTmF0aXZlUGF5bWVudE1ldGhvZHMud2ViQXBpJywgJ3BsYXRmb3JtV2ViQXBwLm9iakNvbXBhcmVTZXJ2aWNlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLFxyXG4gICAgICAgICgkc2NvcGUsIGFwaSwgb2JqQ29tcGFyZVNlcnZpY2UsIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UpID0+IHtcclxuICAgICAgICAgICAgdmFyIGJsYWRlID0gJHNjb3BlLmJsYWRlO1xyXG5cclxuICAgICAgICAgICAgYmxhZGUuaGVhZEljb24gPSAnZmEgZmEtbW9uZXknO1xyXG5cclxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChibGFkZS5jdXJyZW50RW50aXR5SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcGkuZ2V0QnlJZCh7IGlkOiBibGFkZS5jdXJyZW50RW50aXR5SWQgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUuY3VycmVudEVudGl0eSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLm9yaWdpbmFsRW50aXR5ID0gYW5ndWxhci5jb3B5KGJsYWRlLmN1cnJlbnRFbnRpdHkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLnRpdGxlID0gcmVzdWx0Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBibGFkZS5jdXJyZW50RW50aXR5ID0geyBpc0VuYWJsZWQ6IHRydWUgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLm9yaWdpbmFsRW50aXR5ID0gYW5ndWxhci5jb3B5KGJsYWRlLmN1cnJlbnRFbnRpdHkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBibGFkZS50aXRsZSA9IFwiTmF0aXZlUGF5bWVudE1ldGhvZHMuYmxhZGVzLm1ldGhvZC1kZXRhaWxzLmxhYmVscy5uZXctbWV0aG9kXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2V0Rm9ybSA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgICAgICBibGFkZS5mb3JtU2NvcGUgPSBmb3JtO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2FuU2F2ZSgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpc0RpcnR5KCkgJiYgKCFibGFkZS5mb3JtU2NvcGUgfHwgYmxhZGUuZm9ybVNjb3BlLiR2YWxpZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGlydHkoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYmxhZGUub3JpZ2luYWxFbnRpdHkgJiYgIW9iakNvbXBhcmVTZXJ2aWNlLmVxdWFsKGJsYWRlLm9yaWdpbmFsRW50aXR5LCBibGFkZS5jdXJyZW50RW50aXR5KSAmJiAhYmxhZGUuaXNOZXcgJiYgYmxhZGUuaGFzVXBkYXRlUGVybWlzc2lvbigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBibGFkZS5tZXRhRmllbGRzID0gW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICduYW1lJyxcclxuICAgICAgICAgICAgICAgICAgICBpc1JlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzUmVhZE9ubHk6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIk5hdGl2ZVBheW1lbnRNZXRob2RzLmJsYWRlcy5tZXRob2QtZGV0YWlscy5sYWJlbHMubmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlVHlwZTogXCJTaG9ydFRleHRcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnY29kZScsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpc1JlYWRPbmx5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMubWV0aG9kLWRldGFpbHMubGFiZWxzLmNvZGVcIixcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVR5cGU6IFwiU2hvcnRUZXh0XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2lzRW5hYmxlZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiTmF0aXZlUGF5bWVudE1ldGhvZHMuYmxhZGVzLm1ldGhvZC1kZXRhaWxzLmxhYmVscy5pc0VuYWJsZWRcIixcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVR5cGU6IFwiQm9vbGVhblwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdkZXNjcmlwdGlvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiTmF0aXZlUGF5bWVudE1ldGhvZHMuYmxhZGVzLm1ldGhvZC1kZXRhaWxzLmxhYmVscy5kZXNjcmlwdGlvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlVHlwZTogXCJMb25nVGV4dFwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICBibGFkZS50b29sYmFyQ29tbWFuZHMgPSBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5yZWZyZXNoXCIsIGljb246ICdmYSBmYS1yZWZyZXNoJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7IGJsYWRlLnJlZnJlc2goKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6ICgpID0+IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5zYXZlXCIsIGljb246ICdmYSBmYS1zYXZlJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zYXZlKGJsYWRlLmN1cnJlbnRFbnRpdHksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RCbGFkZSA9ICRzY29wZS4kcGFyZW50LiRwYXJlbnQuYmxhZGVzLmZpbmQoeCA9PiB4LmlkID09PSBcInBheW1lbnQtbWV0aG9kcy1saXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UuY2xvc2VCbGFkZShibGFkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdEJsYWRlLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuRXhlY3V0ZU1ldGhvZDogY2FuU2F2ZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInBsYXRmb3JtLmNvbW1hbmRzLnJlc2V0XCIsIGljb246ICdmYSBmYS11bmRvJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuY29weShibGFkZS5vcmlnaW5hbEVudGl0eSwgYmxhZGUuY3VycmVudEVudGl0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBpc0RpcnR5LFxyXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246IGJsYWRlLnVwZGF0ZVBlcm1pc3Npb25cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIGJsYWRlLnJlZnJlc2goKTtcclxuICAgICAgICB9XSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXHJcbiAgICAuY29udHJvbGxlcignTmF0aXZlUGF5bWVudE1ldGhvZHMucGF5bWVudERldGFpbHNMb2dvQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0ZpbGVVcGxvYWRlcicsICdwbGF0Zm9ybVdlYkFwcC5ibGFkZU5hdmlnYXRpb25TZXJ2aWNlJywgJ3BsYXRmb3JtV2ViQXBwLmRpYWxvZ1NlcnZpY2UnLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsIEZpbGVVcGxvYWRlciwgYmxhZGVOYXZpZ2F0aW9uU2VydmljZSwgZGlhbG9nU2VydmljZSkge1xyXG4gICAgICAgICAgICB2YXIgYmxhZGUgPSAkc2NvcGUuYmxhZGU7XHJcbiAgICAgICAgICAgIGJsYWRlLnRpdGxlID0gJ05hdGl2ZVBheW1lbnRNZXRob2RzLmJsYWRlcy5wYXltZW50LWxvZ28udGl0bGUnO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUubG9nb1VwbG9hZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2dvVXBsb2FkZXIgPSAkc2NvcGUubG9nb1VwbG9hZGVyID0gbmV3IEZpbGVVcGxvYWRlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgYXV0b1VwbG9hZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVBZnRlclVwbG9hZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnaW1hZ2VGaWx0ZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcHJvdmFsID0gL14uKlxcLihwbmd8Z2lmfHN2ZykkLy50ZXN0KGl0ZW0ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFwcHJvdmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlhbG9nID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJGaWxldHlwZSBlcnJvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIk9ubHkgUE5HLCBHSUYgb3IgU1ZHIGZpbGVzIGFyZSBhbGxvd2VkLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dTZXJ2aWNlLnNob3dFcnJvckRpYWxvZyhkaWFsb2cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcHJvdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxvZ29VcGxvYWRlci51cmwgPSAnYXBpL2Fzc2V0cz9mb2xkZXJVcmw9cGF5bWVudExvZ29zJztcclxuXHJcbiAgICAgICAgICAgICAgICBsb2dvVXBsb2FkZXIub25TdWNjZXNzSXRlbSA9IGZ1bmN0aW9uIChfLCB1cGxvYWRlZEltYWdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLmN1cnJlbnRFbnRpdHkubG9nb1VybCA9IHVwbG9hZGVkSW1hZ2VzWzBdLnVybDtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgbG9nb1VwbG9hZGVyLm9uRXJyb3JJdGVtID0gZnVuY3Rpb24gKGVsZW1lbnQsIHJlc3BvbnNlLCBzdGF0dXMsIF8pIHtcclxuICAgICAgICAgICAgICAgICAgICBibGFkZU5hdmlnYXRpb25TZXJ2aWNlLnNldEVycm9yKGVsZW1lbnQuX2ZpbGUubmFtZSArICcgZmFpbGVkOiAnICsgKHJlc3BvbnNlLm1lc3NhZ2UgPyByZXNwb25zZS5tZXNzYWdlIDogc3RhdHVzKSwgYmxhZGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGJsYWRlLm9yaWdpbmFsRW50aXR5ID0gYmxhZGUuY3VycmVudEVudGl0eTtcclxuICAgICAgICAgICAgICAgIGJsYWRlLmN1cnJlbnRFbnRpdHkgPSBhbmd1bGFyLmNvcHkoYmxhZGUuY3VycmVudEVudGl0eSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBsZXQgZm9ybVNjb3BlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2V0Rm9ybSA9IGZ1bmN0aW9uIChmb3JtKSB7IGZvcm1TY29wZSA9IGZvcm07IH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5icm93c2VGaWxlcyA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lkfWApLmNsaWNrKClcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaXNEaXJ0eSgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhYW5ndWxhci5lcXVhbHMoYmxhZGUuY3VycmVudEVudGl0eSwgYmxhZGUub3JpZ2luYWxFbnRpdHkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjYW5TYXZlKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzRGlydHkoKSAmJiBmb3JtU2NvcGUgJiYgZm9ybVNjb3BlLiR2YWxpZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYmxhZGUuc2F2ZUNoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmNvcHkoYmxhZGUuY3VycmVudEVudGl0eSwgYmxhZGUub3JpZ2luYWxFbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJsYWRlQ2xvc2UoKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGJsYWRlLnRvb2xiYXJDb21tYW5kcyA9IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcInBsYXRmb3JtLmNvbW1hbmRzLnNhdmVcIiwgaWNvbjogJ2ZhcyBmYS1zYXZlJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiBibGFkZS5zYXZlQ2hhbmdlcyxcclxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBjYW5TYXZlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwicGxhdGZvcm0uY29tbWFuZHMuc2V0LXRvLWRlZmF1bHRcIiwgaWNvbjogJ2ZhIGZhLXVuZG8nLFxyXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUuY3VycmVudEVudGl0eS5sb2dvVXJsID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIGJsYWRlLm9uQ2xvc2UgPSBmdW5jdGlvbiAoY2xvc2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93Q29uZmlybWF0aW9uSWZOZWVkZWQoaXNEaXJ0eSgpLCBjYW5TYXZlKCksIGJsYWRlLCBibGFkZS5zYXZlQ2hhbmdlcywgY2xvc2VDYWxsYmFjayxcclxuICAgICAgICAgICAgICAgICAgICBcIk5hdGl2ZVBheW1lbnRNZXRob2RzLmRpYWxvZ3MucGF5bWVudC1kZXRhaWxzLXNhdmUudGl0bGVcIiwgXCJOYXRpdmVQYXltZW50TWV0aG9kcy5kaWFsb2dzLnBheW1lbnQtZGV0YWlscy1zYXZlLm1lc3NhZ2VcIik7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBibGFkZS5yZWZyZXNoKCk7XHJcbiAgICB9XSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXHJcbiAgICAuY29udHJvbGxlcignTmF0aXZlUGF5bWVudE1ldGhvZHMubWV0aG9kc0xpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnTmF0aXZlUGF5bWVudE1ldGhvZHMud2ViQXBpJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLFxyXG4gICAgICAgICgkc2NvcGUsIGFwaSwgYmxhZGVOYXZpZ2F0aW9uU2VydmljZSkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdmFyIGJsYWRlID0gJHNjb3BlLmJsYWRlO1xyXG4gICAgICAgICAgICBibGFkZS50aXRsZSA9ICdOYXRpdmVQYXltZW50TWV0aG9kcy5ibGFkZXMubWV0aG9kcy1saXN0LnRpdGxlJztcclxuICAgICAgICAgICAgYmxhZGUuaGVhZEljb24gPSAnZmEgZmEtbW9uZXknO1xyXG4gICAgICAgICAgICBibGFkZS50b29sYmFyQ29tbWFuZHMgPSBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5yZWZyZXNoXCIsIGljb246ICdmYSBmYS1yZWZyZXNoJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7IGJsYWRlLnJlZnJlc2goKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6ICgpID0+IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5hZGRcIiwgaWNvbjogJ2ZhIGZhLXBsdXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6ICgpID0+IHsgc2hvd0RldGFpbHNCbGFkZShudWxsKSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6ICgpID0+IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJwbGF0Zm9ybS5jb21tYW5kcy5kZWxldGVcIiwgaWNvbjogJ2ZhIGZhLXRyYXNoJyxcclxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHMgPSBzZWxlY3RlZEl0ZW1zLm1hcCh4ID0+IHguaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmRlbGV0ZSh7IGlkczogaWRzIH0sIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiAoKSA9PiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIGJsYWRlLnJlZnJlc2ggPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBibGFkZS5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYXBpLmdldCgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLmRhdGEgPSBkYXRhLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuc2VsZWN0ZWRBbGwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS51cGRhdGVTZWxlY3Rpb25MaXN0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IGJsYWRlLmRhdGEuZmlsdGVyKChpdGVtKSA9PiBpdGVtLnNlbGVjdGVkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdEFsbCA9IChzZWxlY3RlZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGJsYWRlLmRhdGEsIChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHNlbGVjdGVkO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlU2VsZWN0aW9uTGlzdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0Tm9kZSA9IChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWROb2RlSWQgPSBub2RlLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dEZXRhaWxzQmxhZGUobm9kZS5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dEZXRhaWxzQmxhZGUgKGl0ZW1JZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRldGFpbHNCbGFkZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogJ3BheW1lbnQtbWV0aG9kLWRldGFpbHMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOYXRpdmVQYXltZW50TWV0aG9kcy5tZXRob2REZXRhaWxzQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdNb2R1bGVzLyQoVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcykvU2NyaXB0cy9ibGFkZXMvbWV0aG9kLWRldGFpbHMudHBsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFbnRpdHlJZDogaXRlbUlkXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2Uuc2hvd0JsYWRlKGRldGFpbHNCbGFkZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGJsYWRlLnJlZnJlc2goKTtcclxuICAgICAgICB9XSk7XHJcbiIsImFuZ3VsYXIubW9kdWxlKCdOYXRpdmVQYXltZW50TWV0aG9kcycpXHJcbiAgICAuZmFjdG9yeSgnTmF0aXZlUGF5bWVudE1ldGhvZHMud2ViQXBpJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbiAoJHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuICRyZXNvdXJjZSgnYXBpL25hdGl2ZS1wYXltZW50LW1ldGhvZHMnLCB7fSwge1xyXG4gICAgICAgICAgICBkZWxldGU6IHsgbWV0aG9kOiAnREVMRVRFJywgdXJsOiAnYXBpL25hdGl2ZS1wYXltZW50LW1ldGhvZHMnIH0sXHJcbiAgICAgICAgICAgIGdldEJ5SWQ6IHsgbWV0aG9kOiAnR0VUJywgdXJsOiAnYXBpL25hdGl2ZS1wYXltZW50LW1ldGhvZHMvOmlkJyB9LFxyXG4gICAgICAgICAgICBzYXZlOiB7IG1ldGhvZDogJ1BPU1QnLCB1cmw6ICdhcGkvbmF0aXZlLXBheW1lbnQtbWV0aG9kcycgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xyXG4iLCJhbmd1bGFyLm1vZHVsZSgncGxhdGZvcm1XZWJBcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ05hdGl2ZVBheW1lbnRNZXRob2RzLnBheW1lbnRMb2dvV2lkZ2V0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIGJsYWRlID0gJHNjb3BlLmJsYWRlO1xyXG5cclxuICAgICAgICAkc2NvcGUub3BlbkJsYWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbmV3QmxhZGUgPSB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ3BheW1lbnREZXRhaWxzTG9nbycsXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RW50aXR5OiBibGFkZS5jdXJyZW50RW50aXR5LFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ05hdGl2ZVBheW1lbnRNZXRob2RzLnBheW1lbnREZXRhaWxzTG9nb0NvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdNb2R1bGVzLyQoVmlydG9Db21tZXJjZS5OYXRpdmVQYXltZW50TWV0aG9kcykvU2NyaXB0cy9ibGFkZXMvbWV0aG9kLWxvZ28uaHRtbCdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2Uuc2hvd0JsYWRlKG5ld0JsYWRlLCBibGFkZSk7XHJcbiAgICAgICAgfTtcclxufV0pO1xyXG4iXSwibmFtZXMiOlsibW9kdWxlTmFtZSIsInVuZGVmaW5lZCIsIkFwcERlcGVuZGVuY2llcyIsInB1c2giLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIiRzY29wZSIsImJsYWRlTmF2aWdhdGlvblNlcnZpY2UiLCJzaG93QmxhZGUiLCJpZCIsInRlbXBsYXRlIiwiaXNDbG9zaW5nRGlzYWJsZWQiLCJydW4iLCJtYWluTWVudVNlcnZpY2UiLCJ3aWRnZXRTZXJ2aWNlIiwiJHN0YXRlIiwibWVudUl0ZW0iLCJwYXRoIiwiaWNvbiIsInRpdGxlIiwicHJpb3JpdHkiLCJhY3Rpb24iLCJnbyIsInBlcm1pc3Npb24iLCJhZGRNZW51SXRlbSIsInJlZ2lzdGVyV2lkZ2V0IiwiYXBpIiwib2JqQ29tcGFyZVNlcnZpY2UiLCJibGFkZSIsImlzRGlydHkiLCJvcmlnaW5hbEVudGl0eSIsImVxdWFsIiwiY3VycmVudEVudGl0eSIsImlzTmV3IiwiaGFzVXBkYXRlUGVybWlzc2lvbiIsImhlYWRJY29uIiwicmVmcmVzaCIsImN1cnJlbnRFbnRpdHlJZCIsImdldEJ5SWQiLCJyZXN1bHQiLCJjb3B5IiwibmFtZSIsImlzRW5hYmxlZCIsImlzTG9hZGluZyIsInNldEZvcm0iLCJmb3JtIiwiZm9ybVNjb3BlIiwibWV0YUZpZWxkcyIsImlzUmVxdWlyZWQiLCJpc1JlYWRPbmx5IiwidmFsdWVUeXBlIiwidG9vbGJhckNvbW1hbmRzIiwiZXhlY3V0ZU1ldGhvZCIsImNhbkV4ZWN1dGVNZXRob2QiLCJzYXZlIiwibGlzdEJsYWRlIiwiJHBhcmVudCIsImJsYWRlcyIsImZpbmQiLCJ4IiwiY2xvc2VCbGFkZSIsIiR2YWxpZCIsInVwZGF0ZVBlcm1pc3Npb24iLCJGaWxlVXBsb2FkZXIiLCJkaWFsb2dTZXJ2aWNlIiwibG9nb1VwbG9hZGVyIiwic2NvcGUiLCJoZWFkZXJzIiwiQWNjZXB0IiwiYXV0b1VwbG9hZCIsInJlbW92ZUFmdGVyVXBsb2FkIiwiZmlsdGVycyIsImZuIiwiaXRlbSIsImFwcHJvdmFsIiwidGVzdCIsImRpYWxvZyIsIm1lc3NhZ2UiLCJzaG93RXJyb3JEaWFsb2ciLCJvblN1Y2Nlc3NJdGVtIiwiXyIsInVwbG9hZGVkSW1hZ2VzIiwibG9nb1VybCIsIm9uRXJyb3JJdGVtIiwiZWxlbWVudCIsInJlc3BvbnNlIiwic3RhdHVzIiwic2V0RXJyb3IiLCJfZmlsZSIsImVxdWFscyIsImNhblNhdmUiLCJicm93c2VGaWxlcyIsIndpbmRvdyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsaWNrIiwic2F2ZUNoYW5nZXMiLCJibGFkZUNsb3NlIiwib25DbG9zZSIsImNsb3NlQ2FsbGJhY2siLCJzaG93Q29uZmlybWF0aW9uSWZOZWVkZWQiLCJzZWxlY3RlZEl0ZW1zIiwic2hvd0RldGFpbHNCbGFkZSIsIml0ZW1JZCIsImRldGFpbHNCbGFkZSIsImlkcyIsIm1hcCIsImRlbGV0ZSIsImxlbmd0aCIsImdldCIsImRhdGEiLCJyZXN1bHRzIiwic2VsZWN0ZWRBbGwiLCJ1cGRhdGVTZWxlY3Rpb25MaXN0IiwiZmlsdGVyIiwic2VsZWN0ZWQiLCJzZWxlY3RBbGwiLCJmb3JFYWNoIiwic2VsZWN0Tm9kZSIsIm5vZGUiLCJzZWxlY3RlZE5vZGVJZCIsImZhY3RvcnkiLCIkcmVzb3VyY2UiLCJtZXRob2QiLCJvcGVuQmxhZGUiLCJuZXdCbGFkZSJdLCJzb3VyY2VSb290IjoiIn0=